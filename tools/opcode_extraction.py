import pandas as pd
import numpy as np
from time import time


def fill_df(main_df, codes):

  '''
   = Change filname when opening the asm file
  '''

  for i,val in enumerate(main_df['Id']):

    start = time()

    try:

      f = open('/Users/Arvind/Downloads/bytes/' + val + '.bytes', 'r')
      data = f.readlines()
      f.close()

      for line in data:
        for word in line.split()[1:]:
          if word in opcodes:
              main_df.at[i, word] += 1

      print("finished: " + val + " in " + str(time() - start) + " seconds. \t" + str(i + 1) + " done so far.")

    except FileNotFoundError:

      print("The file " + val + " was not found.")

  return main_df


def generate_df(codes):

  '''
   = Add in the corret file to get the list of asm filenames
   = Change number in for loop to match number of files
  '''

  df = pd.read_csv('crunchedTrainLabels.csv')

  for code in codes:
    df[code] = [0]*3915

  return df


if __name__ == '__main__':

  start = time()

  opcodes = ["kaggle", "microsoft"]

  main_df = generate_df(opcodes)
  main_df = fill_df(main_df, opcodes)
  main_df.to_csv("byte_frequency.csv", index=False)


  print("This took " + str(time() - start) + " seconds.")


